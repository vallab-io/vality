# AWS 리전 간 데이터 전송 비용 상세

## 📍 현재 구성

- **EC2**: ap-northeast-2 (서울, AWS)
- **Redis (Upstash)**: ap-northeast-1 (도쿄)
- **데이터 전송 경로**: EC2 ↔ Upstash (서울 ↔ 도쿄)

---

## 💰 데이터 전송 비용 부담 주체

### 🔴 **AWS EC2 → Upstash (Outbound)**

**비용 부담**: **EC2 사용자 (당신)** ✅

- AWS EC2에서 **나가는 데이터 (Outbound/Egress)**에 대해 비용 발생
- **$0.02/GB** (ap-northeast-2 → ap-northeast-1)
- 모든 아웃바운드 트래픽에 대해 부과

**예시**:
- EC2에서 Upstash Redis로 1GB 전송 = **$0.02**
- EC2에서 Upstash Redis로 10GB 전송 = **$0.20**
- EC2에서 Upstash Redis로 100GB 전송 = **$2.00**

---

### ✅ **Upstash → AWS EC2 (Inbound)**

**비용 부담**: **일반적으로 무료** ✅

- AWS로 **들어오는 데이터 (Inbound/Ingress)**는 **무료**
- Upstash에서 EC2로 데이터를 보내는 것은 EC2 사용자 비용 발생 없음
- 하지만 **Upstash 자체에서 비용을 부과할 수 있음** (Upstash 정책 확인 필요)

---

## 📊 AWS 데이터 전송 비용 구조

### 기본 원칙

1. **Outbound (나가는 데이터)**: **비용 발생** 💰
   - EC2 → 인터넷
   - EC2 → 다른 AWS 리전
   - EC2 → 다른 클라우드 서비스

2. **Inbound (들어오는 데이터)**: **일반적으로 무료** ✅
   - 인터넷 → EC2
   - 다른 AWS 리전 → EC2
   - 다른 클라우드 서비스 → EC2

3. **같은 리전 내**: **무료** ✅
   - EC2 → RDS (같은 리전)
   - EC2 → ElastiCache (같은 리전)
   - EC2 → S3 (같은 리전)

---

### ap-northeast-2 (서울) 데이터 전송 비용

| 전송 방향 | 대상 | 비용 (GB당) | 비고 |
|----------|------|------------|------|
| **Outbound** | ap-northeast-1 (도쿄) | **$0.02** | 리전 간 전송 |
| **Outbound** | 인터넷 (일반) | $0.12 | 아웃바운드 일반 |
| **Outbound** | 인터넷 (중국) | $0.15 | 중국 전용 |
| **Inbound** | 모든 소스 | **무료** | 인바운드 모두 무료 |
| **같은 리전** | ap-northeast-2 내 | **무료** | 같은 리전 무료 |

---

## 🔍 Upstash 데이터 전송 비용

### Upstash 정책 (확인 필요)

**일반적인 클라우드 서비스 정책**:
- Inbound (들어오는 데이터): 무료
- Outbound (나가는 데이터): 무료 또는 제한 내 무료

**Upstash 무료 티어**:
- Bandwidth: 2GB/월 (전체, in+out 합산으로 추정)
- 초과 시: 비용 발생 또는 차단

**확인 필요**:
- Upstash에서 리전 간 데이터 전송에 대한 별도 비용 정책
- 무료 티어 Bandwidth가 in+out 합산인지, outbound만인지

---

## 💡 실제 비용 계산 예시 (MVP/초기 단계)

### 시나리오 1: MVP 초기 (사용자 50-100명)

**가정**:
- 월 100개 이슈 발송
- 구독자 평균 20명/뉴스레터
- 큐 작업 데이터: 평균 1KB/작업
- API 요청 (Redis 캐싱): 일일 1,000건, 평균 0.5KB/요청

**데이터 전송량**:
- EC2 → Upstash (큐 작업 추가): 100 × 1KB = 0.1MB
- EC2 → Upstash (캐시 쓰기): 30,000 × 0.5KB = 15MB
- Upstash → EC2 (큐 작업 가져오기): 100 × 1KB = 0.1MB
- Upstash → EC2 (캐시 읽기): 30,000 × 0.5KB = 15MB
- **총 Outbound (EC2 → Upstash): 15.1MB/월**

**비용**:
- AWS EC2 Outbound: 15.1MB × $0.02/GB = **$0.0003** ≈ **$0.00**
- Upstash Bandwidth: 30.2MB (무료 티어 2GB 내) = **무료**

**결론**: **거의 0달러, 전혀 신경 쓸 필요 없음** ✅

---

### 시나리오 2: 성장 초기 (사용자 500명)

**가정**:
- 월 500개 이슈 발송
- 구독자 평균 50명/뉴스레터
- 큐 작업 데이터: 평균 1KB/작업
- API 요청: 일일 10,000건, 평균 0.5KB/요청

**데이터 전송량**:
- EC2 → Upstash (큐 작업): 500 × 1KB = 0.5MB
- EC2 → Upstash (캐시 쓰기): 300,000 × 0.5KB = 150MB
- Upstash → EC2 (캐시 읽기): 300,000 × 0.5KB = 150MB
- **총 Outbound: 150.5MB/월**

**비용**:
- AWS EC2 Outbound: 150.5MB × $0.02/GB = **$0.003** ≈ **$0.00**
- Upstash Bandwidth: 300.5MB (무료 티어 내) = **무료**

**결론**: **여전히 거의 0달러, 신경 쓸 필요 없음** ✅

---

### 시나리오 3: 높은 트래픽 (사용자 5,000명)

**가정**:
- 월 5,000개 이슈 발송
- 구독자 평균 200명/뉴스레터
- API 요청: 일일 100,000건

**데이터 전송량**:
- EC2 → Upstash: 약 500MB/월

**비용**:
- AWS EC2 Outbound: 500MB × $0.02/GB = **$0.01**

**결론**: **1센트, 여전히 무시 가능** ✅

---

### 시나리오: 높은 트래픽

**가정**:
- 월 100만 요청
- 평균 1KB/요청

**데이터 전송량**:
- EC2 → Upstash: 100만 × 1KB = 1GB
- Upstash → EC2: 100만 × 1KB = 1GB
- **총합: 2GB/월**

**비용**:
- AWS EC2 Outbound: 1GB × $0.02/GB = **$0.02**
- Upstash Bandwidth: 2GB (무료 티어 2GB 한도) = **무료** 또는 **초과 시 비용**

**결론**: 여전히 매우 작은 비용 ✅

---

## 📋 요약

### 비용 부담 주체

1. **EC2 → Upstash (Outbound)**: **EC2 사용자 (당신) 부담** 💰
   - $0.02/GB
   - 일반적으로 매우 작은 금액

2. **Upstash → EC2 (Inbound)**: **일반적으로 무료** ✅
   - AWS는 인바운드 무료
   - Upstash Bandwidth 제한 내에서는 무료

3. **Upstash Bandwidth 초과**: **Upstash 사용자 (당신) 부담** 💰
   - 무료 티어: 2GB/월
   - 초과 시 비용 발생 또는 차단

---

### 실제 비용 영향도 (MVP/초기 단계)

| 사용자 수 | 월 Outbound | 비용/월 | 평가 |
|----------|------------|---------|------|
| **50-100명** | ~15MB | **$0.00** | ✅ 전혀 신경 쓸 필요 없음 |
| **500명** | ~150MB | **$0.00** | ✅ 전혀 신경 쓸 필요 없음 |
| **5,000명** | ~500MB | **$0.01** | ✅ 무시 가능 |
| **50,000명** | ~5GB | **$0.10** | ✅ 여전히 매우 작음 |

**결론**: 
- ✅ **MVP/초기 단계에서는 거의 $0.00**
- ✅ **리전 간 데이터 전송 비용은 전혀 신경 쓸 필요 없음**
- ✅ **사용자 5만명 이상 되어도 월 $0.10 수준 (무시 가능)**
- ✅ **비용은 전혀 문제가 되지 않음**

---

## 🎯 권장사항

### 현재 구성 (EC2 ap-northeast-2 ↔ Upstash ap-northeast-1)

**비용 측면** (MVP/초기 단계):
- ✅ **데이터 전송 비용: 거의 $0.00** (전혀 신경 쓸 필요 없음)
- ✅ 무료 티어 사용 시 Upstash Bandwidth 제한 모니터링 필요 (2GB/월)
- ✅ **비용은 전혀 문제가 되지 않음**

**성능 측면**:
- ⚠️ 30-50ms 지연 (뉴스레터 큐 작업에는 허용 가능)
- ⚠️ 리전 분산으로 인한 운영 복잡성

**결론** (MVP/초기 단계):
- ✅ **비용은 전혀 신경 쓸 필요 없음** (거의 $0.00)
- ⚠️ **성능(30-50ms 지연)과 운영 복잡성이 더 중요한 고려사항**
- 💡 **리전 통합을 권장하는 이유는 비용이 아니라 성능과 운영 편의성 때문**

---

### 비용 최적화 (필요 시)

1. **Redis를 ap-northeast-2로 이동** (EC2에 직접 설치)
   - 리전 간 데이터 전송 비용 제거
   - 지연시간 감소
   - 운영 복잡성 감소

2. **Upstash Bandwidth 모니터링**
   - 2GB 제한 모니터링
   - 80% 도달 시 알림 설정

3. **데이터 최소화**
   - 불필요한 데이터 전송 최소화
   - 압축 사용 (필요 시)

---

## 📝 체크리스트

### 비용 관리

- [ ] CloudWatch에서 EC2 데이터 전송 비용 모니터링
- [ ] Upstash Bandwidth 사용량 모니터링 (80% 도달 시 알림)
- [ ] 월간 비용 리포트 확인

### 성능 모니터링

- [ ] EC2 ↔ Upstash 지연시간 측정
- [ ] API 응답 시간 모니터링
- [ ] 데이터 전송량 추적

---

## 🎯 최종 결론 (MVP/초기 단계)

**비용 부담**:
- ✅ **EC2 → Upstash**: 당신이 부담 ($0.02/GB)
- ✅ **실제 비용 (MVP)**: **거의 $0.00** (전혀 신경 쓸 필요 없음)
- ✅ **실제 비용 (5,000명)**: **$0.01/월** (여전히 무시 가능)

**MVP/초기 단계 평가**:
- ✅ **비용은 전혀 문제가 되지 않음** - 신경 쓸 필요 없음
- ⚠️ 성능 (30-50ms 지연)과 운영 복잡성이 더 중요한 고려사항
- 💡 리전 통합(EC2에 Redis 설치)을 권장하는 이유는 **비용이 아니라 성능과 운영 편의성** 때문

**결론**: 
- **MVP/서비스 초기에는 outbound 비용은 전혀 신경 쓸 필요 없습니다** ✅
- 사용자 5만명 이상 되어도 월 $0.10 수준으로 여전히 무시 가능

